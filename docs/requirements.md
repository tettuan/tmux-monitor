# 要求事項

## 利用者の欲求・背景

### 根源的欲求

根源的欲求:

Claude Code 稼働時間の最大化。

AI開発において、CLIツーによるコーディングを行っているが各ペインの中で動作状況が見えない。
各ペインの稼働を最大化するためにはフル稼働状態を作る必要がある。フル稼働にするためには、今現在作業が完了し、手焼き状態が生じた辺を把握する必要がある。さらに手やペインに対して新たな作業指示を出すマネージャーに状況を報告し、次のタスクを割り当てさせる必要がある。

#### サイクル

- 起動から4時間終了: 5時間程度でClaude Codeのセッションが終了するため1時間前に監視を終了する
- 5分サイクル監視: 状況変化の起こる間隔が約5分であるため
- 30秒サイクル: 送信した指示が、入力欄に残って送信されていないケースが散見されるため、Enterで送信処理を定期実行する

#### 指示の意図

- pane の pane_title 変更: ステータスを把握するため。
- main pane への報告: 空きpaneへの指示出しを行うため

#### 機能

- 指示書指定: main paneへの指示書を、効率よく渡すため
  - 予約実行と合わせると、指示の予約ができる

#### 中断

- キー操作での即時 monitor 停止
- panes終了指示による、panes 停止


#### メモリ効率

- **クリアコマンド実行**: DONE/IDLEペインの自動クリア
  - claude code へ `/clear` コマンドを送信
- main paneへ不必要な報告を避ける（変化のないpaneステータスは送らない）

## 判別要件

- **自動セッション発見**: 最もアクティブなtmuxセッションを自動的に選択、id番号が小さい準にmain,manager1,manager2,secretary,workrs*9
- **WorkerStatus追跡**: WORKING/IDLE/DONE/UNKNOWNの自動判定
- **スケジュール実行**: Tokyo時間（`--time=HH:MM`）、直近到来する時刻
- **単発実行**: `--onetime`オプションで初回起動のみで終了

### 表示・ログ
- **リアルタイム表示**: ペイン一覧・状態・詳細情報
- **構造化ログ**: 監視プロセス・エラー・デバッグ情報
- **プログレス表示**: 監視サイクル・タイミング情報

### セキュリティ要件
- **最小権限原則**: 必要最小限のDeno権限（`--allow-run`、`--allow-read`）
- **コマンドインジェクション対策**: tmuxコマンドの適切なエスケープ
- **ファイルアクセス制限**: 指示ファイルのみの読み取り許可

### 信頼性要件
- **エラーハンドリング**: 全域性原則に基づく完全なエラー処理
- **データ整合性**: ペイン状態の一貫性保証

### 保守性要件
- **モジュール設計**: 単一責任原則による責任分離
- **依存性注入**: テスタビリティとモジュール性の確保
- **型安全性**: TypeScriptの厳密な型チェック

## 4. 技術要件

### 4.1 開発環境
- **ランタイム**: Deno 2.4.0+
- **言語**: TypeScript（厳密モード）
- **フォーマット**: Deno標準フォーマッター

### 4.2 外部依存関係
- **tmux**: システムにインストール済み
- **標準ライブラリ**: Deno標準ライブラリ優先
- **HTTPSモジュール**: ESモジュール形式

### 4.3 配布・実行
- **JSRパッケージ**: `@aidevtool/tmux-monitor`
- **CLI実行**: `deno run --allow-run jsr:@aidevtool/tmux-monitor`
- **グローバルインストール**: `deno install`対応

## 5. 制約事項

### 機能制約
- **単一セッション**: 同時に1つのtmuxセッションのみ監視
- **ペイン数制限**: 実用的な範囲（100ペイン以下）
- **ネットワーク不要**: ローカル実行のみ

## 6. 品質特性

### 6.1 設計原則
- **全域性原則**: 部分関数の全域関数化
- **型安全性**: Result型による明示的エラーハンドリング
- **単一責任**: 各コンポーネントの明確な責任分離

### 6.2 テスト要件
- **単体テスト**: 各モジュールの包括的テスト
- **統合テスト**: tmux連携の動作確認
- **エラーテスト**: 異常系のテスト

### 6.3 ドキュメント要件
- **API仕様**: 型定義とコメント
- **使用例**: CLIの例


